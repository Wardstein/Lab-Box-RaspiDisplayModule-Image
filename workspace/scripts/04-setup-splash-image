set -x
set -e

export LC_ALL=C

source /common.sh
install_cleanup_trap

# Scripts run as root by default


mv /usr/share/plymouth/themes/pix/splash.png /usr/share/plymouth/themes/pix/splash.png.save
cp /files/Lab-Box_Logo.png /usr/share/plymouth/themes/pix/splash.png
plymouth-set-default-theme --rebuild-initrd pix

# https://scribles.net/customizing-boot-up-screen-on-raspberry-pi/
# "Replace “console=tty1” with “console=tty3”. This redirects boot messages to tty3."
sed -i 's/console=tty1/console=tty3/g' /boot/cmdline.txt
# First replace a possible new line character at the end of the line, then append our new stuff
sed -i ':a;N;$!ba;s/\n/ /g' /boot/cmdline.txt
echo -n " logo.nologo vt.global_cursor_default=0">>/boot/cmdline.txt
cat /boot/cmdline.txt

# This is the ultimate step for Bookworm, otherwise all the above has no effect!
# Thanks to here: https://forums.raspberrypi.com/viewtopic.php?p=2195808#p2195808
# update-initramfs -u
# DOES NOT WORK HERE! MOVED TO STEP 03 IN firstboot.sh
